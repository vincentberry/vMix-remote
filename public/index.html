<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="./assets/img/favicon.png">
    <!--
        <script src="../js/notifications.js" type="text/javascript"></script>
        FONTS
    // <link rel="stylesheet" href="../css/fonts/Roboto-Regular.ttf">-->

    <!--meta SEO-->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keyword" content="">

    <title>REMOTE VMIX</title>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="./assets/style/index.css" />

</head>

<body>
    <nav>
        <div>
            <div class="left">
                <img class="script_down" onclick="copyToClipboard('VmixScript')" src="./assets/icon/VMIX REMOTE.svg"
                    alt="" srcset="">
                <div class="list">
                    <select name="vmix_connect" onclick="chargerFichierXML()" id="vmix_connect">
                        <option value="N">--Please choose the vmix--</option>
                    </select>
                </div>
            </div>
            <h1 id="projetName"></h1>
            <div class="right">
                <div class="statut_vmix_contener">
                    <div id="streaming" class="statut_vmix">
                        <h1>Streaming</h1>
                    </div>
                    <div id="recording" class="statut_vmix">
                        <h1>Recording</h1>
                    </div>
                    <div id="external" class="statut_vmix">
                        <h1>external</h1>
                    </div>
                    <div id="fullscreen" class="statut_vmix">
                        <h1>fullscreen</h1>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- <div class="loader" id = loader></div> -->
    <main>
        <div class="tooltip" id="tooltip-volume">dddd</div>
        <section class="center">
            <div class="ContainerCommandSelector">
                <div>
                    <label for="commandSelector">Select a Command:</label>
                    <select id="commandSelector" onchange="updateCommandDetails()">
                    </select>
                </div>
                <div id="commandDetails"></div>
                <button onclick="sendCommand()">Send Command</button>
            </div>
        </section>
        <button onclick="vMix_ActiveInput()">CUT</button>
        <button onclick="vMix_Fade()">FACE</button>
        <section class="VmixContainer">
            <div id="videoSourcesContainer"></div>
            <div>
                <div id="audioBusesContainer"></div>
                <div id="audioSourcesContainer"></div>
            </div>
        </section>
        <div id="inputsContainer"></div>
    </main>
    <div id="VmixScript" style="display: none;">
        Dim userurl As String = "<p id="urlserverscriptmvix"></p>api.php"
        Dim mac As String = "1"
        Dim random As New Random()
        dim useraccountcode AS String = random.Next(1, 999999999).ToString()
        Console.WriteLine("la session vmix est n°")
        Console.WriteLine(useraccountcode)
        ' ---------------------------------------------------
        Dim ScriptLength As String = "FFA5"
        Dim dummy As String = "none"
        Dim u As String = "xml"
        Dim p As String = "pvmix"
        Do While True
        Dim stateon As String = "NOTCONNECTED"
        Dim state As String = "CONNECTED"
        Dim xml As String = API.XML()
        Dim W As New Net.WebClient
        Dim NC As New System.Collections.Specialized.NameValueCollection
        NC.Add("xml",xml)
        Dim R As String
        Dim con As String = userurl
        NC.Add("connector",useraccountcode)
        NC.Add("STATE",state)
        Dim RESP As Byte()
        Dim conected As String = userurl & p & u
        Try
        RESP = W.UploadValues(con, NC)
        R = System.Text.Encoding.ASCII.GetString(RESP)
        Dim rawCommand As string = R
        ' Afficher la réponse

        ' Diviser la chaîne en un tableau en utilisant |serpare| comme délimiteur
        Dim commands As String() = rawCommand.Split("!"c)
        Dim command
        ' Parcourir chaque commande dans le tableau
        For Each command In commands
        Dim commandParts As String() = command.Split(","c)
        If commandParts.Length = 4 Then
        Dim functionType As String = commandParts(0).Trim()
        Dim inputParam As String = commandParts(1).Trim()
        Dim valueParam As String = commandParts(2).Trim()
        Dim durationParam As String = commandParts(3).Trim()

        ' Appeler la fonction VMix avec les paramètres appropriés
        API.Function(functionType, Input:=inputParam, Value:=valueParam, Duration:=durationParam)
        Console.WriteLine(functionType)
        Elseif Not String.IsNullOrEmpty(rawCommand) Then
        Console.WriteLine(rawCommand)
        Else
        Console.WriteLine("La commande VMix est mal formée.")
        End If
        Next


        catch
        End Try
        Dim StringValue As String = conected & userurl & R
        sleep(1000)
        Loop

    </div>
</body>

<!-- Script JavaScript pour récupérer le fichier XML et générer les éléments -->
<script>
    let activatedBuses = [];
    var commands;
    var id_input;
    var previewNumber;
    var activeNumber;
    var activeOverlay1;
    var activeOverlay2;
    var activeOverlay3;
    var activeOverlay4;

    document.getElementById("urlserverscriptmvix").textContent = window.location.href;
    // Fonction pour charger le fichier XML depuis l'API

    // Fonction pour ajouter ou supprimer une classe en fonction de l'état de la case à cocher
    function updateCheckboxClass(checkboxId, className) {
        if (className) {
            // La case à cocher est cochée, ajouter la classe
            document.getElementById(checkboxId).classList.add('true');
        } else {
            // La case à cocher n'est pas cochée, supprimer la classe
            document.getElementById(checkboxId).classList.remove('true');
        }
    }
</script>
<script src="./assets/js/app.js"></script>
<script src="./assets/js/copy.js"></script>
<script src="./assets/js/processSettings.js"></script>
<script src="./assets/js/processAudioSources.js"></script>
<script src="./assets/js/processAudioBus.js"></script>
<script src="./assets/js/processVideoSources.js"></script>
<script src="./assets/js/processPageSources.js"></script>
<script src="./assets/js/api_vmix.js"></script>
<script src="./assets/js/submit_vmix.js"></script>